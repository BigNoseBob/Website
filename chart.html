<!DOCTYPE html>

<html lang="en">
<header>
    <meta charset="UTF-8">
    <title>Oliver Rayner</title>
    <link rel="stylesheet" type="text/css" href="./css/style.css"/>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</header>

<body>

    <div style="display:flex; flex-direction: column;">
        <div id="page" style="display: flex; height: 200vh; width:100vw">
            <div id="canvas_container" style="height: 100vh; margin: auto; margin-top: 0; float: right;">
                <div id="canvas" style="height:100%; width:100%;"></div>
            </div>
            <div id="chart_container" style="margin: auto; float: left;"><canvas id="chart" style="margin: auto; padding:5%; width: 95%; height: 100vh;"></canvas></div>
        </div>
    </div>
</body>

<style>

@media screen and (max-width: 845px) {

    #page {
        flex-direction: column;
    }
    #canvas_container {
        width: 100vw;
    }
    #chart_container {
        width: 100vw
    }

}

@media screen and (min-width: 846px) {
    #page {
        flex-direction: column;
    }
    #canvas_container {
        width: 100vw;
    }
    #chart_container {
        width: 100vw;
    }
}

</style>

<script type="module">

    const params = new Proxy(new URLSearchParams(window.location.search), {
        get: (searchParams, prop) => searchParams.get(prop),
    })

    import { Chart } from './node_modules/chart.js/auto/auto.js'
    import { PTGChart } from './js/PTG.js'
    const json = await fetch('./js/PTG_data.json').then( res => res.json() )

    const id = params.id
    const brother_name = json.ids[id]
    console.log(brother_name, id)

    console.log('Modules loaded...')

    const chart_container = document.getElementById('chart')
    const ptg_chart = new PTGChart(window, chart_container)

    ptg_chart.create_chart()

    // #f5f3f2

    ptg_chart.add_dataset(brother_name)
    for (let brother of Object.keys(json.brothers)) {
        ptg_chart.add_dataset(brother, true)
    }
    console.log('hello2')
    ptg_chart.update()

    console.log('Initializing renderer')
    const container = document.getElementById("canvas")
    ptg_chart.initialize_renderer(container, brother_name)
    console.log('done.')

    // const selector = document.getElementById('tick')

    // const id = 'oliverr'
    // const checkbox = `<input type="checkbox" id="${id}" name="${id}"><label for="${id}">${id}</label>`

    // selector.innerHTML = checkbox
    

</script>